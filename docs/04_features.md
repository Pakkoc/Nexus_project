# Topia Empire - 기능 명세서

## 1. XP 시스템

### 1.1 XP 획득
- **텍스트 활동**: 채팅 메시지 작성 시 XP 획득
  - 최소/최대 XP 설정 가능
  - 최소 메시지 길이 조건
  - 쿨다운 설정 (초 단위)
  - 일일 획득 제한
- **음성 활동**: 음성 채널 참여 시 XP 획득
  - 쿨다운 간격마다 XP 지급
  - 일일 획득 제한

### 1.2 레벨 시스템
- XP 누적에 따른 자동 레벨업
- 레벨별 요구 XP 커스터마이징
- 레벨업 알림 메시지

### 1.3 레벨 보상
- 특정 레벨 달성 시 역할 자동 부여
- 레벨별 채널 해금 (특정 레벨 이상만 접근 가능)

### 1.4 XP 규칙
- **핫타임**: 특정 시간대에 XP 배율 증가
- **제외 설정**: 특정 채널/역할 XP 획득 제외
- **배율 설정**: 특정 채널/역할별 XP 배율 조정

---

## 2. 화폐 시스템

### 2.1 화폐 종류
- **토피 (무상 화폐)**: 활동으로 획득
- **루비 (유상 화폐)**: 거래/구매로 획득
- 화폐 이름 서버별 커스터마이징 가능

### 2.2 화폐 획득
- **텍스트 활동**: 채팅 시 토피 획득
  - 최소/최대 토피, 쿨다운, 일일 제한 설정
- **음성 활동**: 음성 채널 참여 시 토피 획득
  - 채널 카테고리별 배율 (일반/음감방/잠수방/프리미엄)

### 2.3 화폐 규칙
- **핫타임**: 특정 시간대 화폐 배율 증가
- **제외 설정**: 특정 채널/역할 화폐 획득 제외
- **배율 설정**: 채널/역할별 화폐 배율 조정
- **채널 카테고리**: 음성 채널 유형별 배율 설정

### 2.4 이체
- `/이체` 명령어로 유저 간 화폐 전송
- 최소 이체 금액 설정
- 이체 수수료율 설정 (토피/루비 별도)

### 2.5 화폐 관리자
- 지정된 유저가 `/지급` 명령어로 무제한 화폐 지급 가능

---

## 3. 상점 시스템 (역할선택권)

### 3.1 상점 아이템
- **역할선택권**: 구매 시 여러 색상 역할 중 선택 가능
- **고정 역할**: 역할선택권에 기본으로 부여되는 메인 역할
- **기간제**: 효과 지속일 설정 (만료 시 역할 자동 회수)
- **수량제**: 소모형 아이템

### 3.2 상점 패널
- 디스코드 채널에 상점 패널 메시지 설치
- 버튼 클릭으로 구매 진행

### 3.3 인벤토리
- `/인벤토리` 명령어로 보유 아이템 확인
- 역할선택권: 색상 선택/교환 가능
- 만료일 표시

### 3.4 구매 수수료
- 토피/루비 구매 시 수수료율 설정

---

## 4. 장터 시스템

### 4.1 아이템 거래
- 유저 간 아이템 판매/구매
- 최소 가격 설정
- 최대 등록 개수 제한

### 4.2 장터 패널
- 디스코드 채널에 장터 패널 설치
- 목록 조회, 등록, 내 매물 관리

---

## 5. 게임센터

### 5.1 배팅 게임
- A팀 vs B팀 배팅
- 최소/최대 배팅 금액 설정
- 배당률 계산 (총 배팅액 기준)

### 5.2 게임 진행
1. 관리자가 게임 생성 (팀명 입력)
2. 유저들이 배팅 참여
3. 관리자가 배팅 마감
4. 관리자가 결과 입력
5. 당첨자에게 배당금 지급

### 5.3 게임 관리
- 게임 관리 역할 설정 (게임 생성/결과 입력 권한)
- 경기 취소 시 배팅금 환불

---

## 6. 월말 세금

### 6.1 자동 세금 차감
- **실행 시점**: 매월 마지막 날 23시
- **대상**: 모든 유저의 토피 잔액
- **계산**: 잔액 × 세금률(%)

### 6.2 설정
- 활성화/비활성화 토글
- 세금률 설정 (기본: 3.3%)

### 6.3 기록
- 세금 차감 내역 거래 기록에 저장
- 세금 처리 완료 알림 (로그 채널 설정 시)

---

## 7. 출석 시스템

### 7.1 출석 체크
- `/출석` 명령어로 일일 출석
- 연속 출석 보너스

### 7.2 출석 보상
- 기본 보상 + 연속 출석 보너스
- 토피/루비 지급

---

## 8. 웹 대시보드

### 8.1 인증
- Discord OAuth2 로그인
- 관리 권한 있는 서버만 표시

### 8.2 서버 관리
- XP 설정
- 화폐 설정
- 상점 관리
- 게임센터 설정
- 각종 규칙 (핫타임, 제외, 배율)

### 8.3 데이터 조회
- 지갑 목록
- 거래 기록
- XP 랭킹

---

## 9. 봇 명령어

### 9.1 일반 명령어
| 명령어 | 설명 |
|--------|------|
| `/내정보` | 내 XP, 레벨, 화폐 정보 확인 |
| `/출석` | 일일 출석 체크 |
| `/인벤토리` | 보유 아이템 확인 및 사용 |
| `/이체` | 다른 유저에게 화폐 전송 |

### 9.2 관리자 명령어
| 명령어 | 설명 |
|--------|------|
| `/지급` | 유저에게 화폐 지급 (화폐 관리자) |
| `/상점설치` | 상점 패널 설치 |
| `/장터설치` | 장터 패널 설치 |
| `/게임생성` | 배팅 게임 생성 (게임 관리 역할) |

---

## 10. 자동화 기능

### 10.1 스케줄러
- **만료 아이템 처리**: 매 1시간마다 체크
  - 기간제 아이템 만료 시 역할 자동 회수
- **월말 세금**: 매월 말일 23시
  - 토피 잔액에서 세금 자동 차감

### 10.2 실시간 동기화
- 웹 설정 변경 → Redis Pub/Sub → 봇 즉시 반영
- 봇 재시작 없이 설정 적용
