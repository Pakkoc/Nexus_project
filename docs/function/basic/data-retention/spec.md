# <a:sd:1462495939058208960> 데이터 보존 정책 <a:sd:1462495961178701834>

> ## <a:DH_MINA_04:1462813052138291282> 개요 및 목적
> ```- 서버 탈퇴 유저의 데이터 보존 기간 관리
> - 보존 기간 경과 후 자동 삭제 처리
> - 개인정보 보호 및 데이터베이스 정리```

---

> ## 1단계: 데이터 보존 정책
> ### <a:DH_MINA_03:1462813029577130200> 보존 대상 데이터
> * **XP 및 레벨 데이터**: 유저의 경험치, 레벨 정보
> * **화폐 데이터**: 토피, 루비 잔액
> * **인벤토리**: 보유 아이템, 역할선택권 상태
> * **금고 데이터**: 금고 잔액, 구독 정보
> * **거래 내역**: 이체, 구매, 지급/차감 기록
> * **출석 기록**: 연속 출석일수, 총 출석일수
> <a:DH_MINA_03:1462813029577130200> 서버 탈퇴 시 leftAt 타임스탬프 기록

---

> ## 2단계: 보존 기간 설정
> ### <a:DH_MINA_03:1462813029577130200> 기본 보존 기간
> * 서버 설정에서 지정된 보존 기간 (일 단위)
> * 미설정 시 기본값 적용
> <a:DH_MINA_03:1462813029577130200> 보존 기간 동안 재가입 시 데이터 복구

> ### <a:DH_MINA_03:1462813029577130200> 재가입 시 동작
> * leftAt이 기록된 유저가 재가입하면 leftAt 초기화
> * 기존 XP, 화폐, 인벤토리 등 모든 데이터 유지
> <a:DH_MINA_03:1462813029577130200> 보존 기간 내 재가입 시 데이터 손실 없음

---

> ## 3단계: 자동 삭제 스케줄러
> ### <a:DH_MINA_03:1462813029577130200> 스케줄러 동작
> * **실행 주기**: 1시간마다 자동 체크
> * **처리 대상**: leftAt + 보존기간 < 현재시간인 유저
> <a:DH_MINA_03:1462813029577130200> 봇 시작 시 즉시 1회 실행

> ### <a:DH_MINA_03:1462813029577130200> 삭제 처리 흐름
> ```처리 흐름:
> 1. 모든 서버의 만료된 유저 데이터 조회
> 2. 각 서버별 보존 기간 확인
> 3. 보존 기간 경과한 유저 데이터 삭제
> 4. 삭제된 유저 수 로그 기록```

---

> ## 4단계: 삭제되는 데이터
> ### <a:DH_MINA_03:1462813029577130200> 삭제 항목
> * **GuildMember 레코드**: 해당 서버의 멤버 정보
> * **XP 관련**: 레벨, 경험치, XP 획득 기록
> * **화폐 관련**: 지갑 잔액, 거래 내역
> * **인벤토리**: 보유 아이템, 사용 기록
> * **금고**: 금고 잔액, 구독 정보
> * **기타**: 출석 기록, 게임 참가 기록
> <a:DH_MINA_05:1462814742178693160> 삭제된 데이터는 복구 불가

---

> ## <a:DH_MINA_05:1462814742178693160> 주의사항 및 제약
> ### 1. 복구 불가
> <a:DH_MINA_03:1462813029577130200> 보존 기간 경과 후 삭제된 데이터는 복구할 수 없음
> ### 2. 서버별 설정
> <a:DH_MINA_03:1462813029577130200> 각 서버마다 보존 기간을 개별 설정 가능
> ### 3. 재가입 기회
> <a:DH_MINA_03:1462813029577130200> 보존 기간 내 재가입 시 모든 데이터 유지됨

---

> ### <a:DH_MINA_13:1462814948127146005> 요약
> - 1. **탈퇴 기록**: 서버 탈퇴 시 leftAt 타임스탬프 저장
> - 2. **보존 기간**: 서버별 설정된 기간 동안 데이터 보존
> - 3. **재가입 복구**: 보존 기간 내 재가입 시 데이터 유지
> - 4. **자동 삭제**: 1시간마다 만료 데이터 자동 정리
> - 5. **개인정보 보호**: 불필요한 데이터 자동 삭제로 정보 보호
