# <a:sd:1462495939058208960> Forge 내전 시스템 <a:sd:1462495961178701834>

> ## <a:DH_MINA_04:1462813052138291282> 개요 및 목적
> ```- 참가비 기반 내전 게임 생성 및 관리
> - 팀 배정, 순위 입력 후 자동 보상 분배
> - 일반 유저 내전 요청 → 관리자 승인 워크플로우```

---

> ## 1단계: 내전 패널 설치
> ### <a:DH_MINA_03:1462813029577130200> 패널 설치 과정
> 1. **채널 선택**: 패널을 설치할 텍스트 채널 지정
> 2. **설치 버튼 클릭**: 선택한 채널에 패널 메시지 생성
> 3. **교체**: 다른 채널 선택 시 기존 패널 삭제 후 재생성
> <a:DH_MINA_03:1462813029577130200> 패널에서 내전 생성 버튼으로 내전 시작

---

> ## 2단계: 관리 역할 설정
> ### <a:DH_MINA_03:1462813029577130200> 관리자 역할 지정
> * **managerRoleId**: 내전 관리 권한을 부여할 역할
> * 권한: 내전 생성, 팀 배정, 결과 입력, 취소
> <a:DH_MINA_03:1462813029577130200> 미설정 시 서버 관리 권한자만 관리 가능

---

> ## 3단계: 승인 채널 설정
> ### <a:DH_MINA_03:1462813029577130200> 승인 워크플로우
> * **approvalChannelId**: 내전 요청을 받을 채널
> * 일반 유저가 내전 생성 시 → 승인 채널에 요청 전송
> * 관리자가 승인/조정/거절 결정
> ```승인 흐름:
> 1. 일반 유저가 패널에서 내전 생성 요청
> 2. 승인 채널에 요청 메시지 생성
> 3. 관리자가 승인 → 패널 채널에 내전 메시지 생성
> 4. 관리자가 조정 → 설정 변경 후 승인
> 5. 관리자가 거절 → 요청 삭제```
> <a:DH_MINA_03:1462813029577130200> 미설정 시 관리자만 내전 생성 가능

---

> ## 4단계: 참가비 및 보상 설정
> ### <a:DH_MINA_03:1462813029577130200> 기본 설정
> * **entryFee**: 기본 참가비 (토피)
> * **rankRewards**: 순위별 보상 비율 (기본: 1등 50%, 2등 30%, 3등 15%, 4등 5%)
> <a:DH_MINA_03:1462813029577130200> 합계는 반드시 100%가 되어야 함

> ### <a:DH_MINA_03:1462813029577130200> 보상 계산 방식
> ```예시:
> - 참가자 10명, 참가비 100 토피 → 상금풀 1,000 토피
> - 1등팀 (2명): 500 토피 ÷ 2 = 250 토피/인
> - 2등팀 (2명): 300 토피 ÷ 2 = 150 토피/인```

---

> ## 5단계: 게임 카테고리 관리
> ### <a:DH_MINA_03:1462813029577130200> 카테고리 설정
> * **name**: 카테고리 이름 (예: 발로란트, 롤)
> * **teamCount**: 팀 수 (2~100)
> * **maxPlayersPerTeam**: 팀당 인원 제한 (비워두면 무제한)
> * **winnerTakesAll**: 승자 독식 여부 (1등 100%)
> * **rankRewards**: 커스텀 순위별 보상 비율
> * **enabled**: 활성화 여부
> <a:DH_MINA_03:1462813029577130200> 카테고리 선택 시 해당 설정으로 내전 생성

---

> ## 6단계: 봇 내전 패널 동작
> ### <a:DH_MINA_03:1462813029577130200> 패널 버튼
> * **직접 생성**: 모달에서 제목, 팀 수, 인원, 보상, 참가비 직접 입력
> * **카테고리 선택**: 등록된 카테고리 중 선택
> <a:DH_MINA_03:1462813029577130200> 카테고리가 없으면 직접 생성만 가능

> ### <a:DH_MINA_03:1462813029577130200> 내전 메시지 UI
> ```표시 정보:
> - 제목 및 상태 (모집중/팀배정중/경기중/완료/취소)
> - 참가비, 참가자 수, 상금풀
> - 순위별 보상 비율
> - 참가자/팀 배정 현황```

---

> ## 7단계: 내전 진행 흐름
> ### <a:DH_MINA_03:1462813029577130200> 상태 흐름
> ```pending_approval → open → team_assign → in_progress → finished/cancelled```

> ### <a:DH_MINA_03:1462813029577130200> 모집 단계 (open)
> * **참가하기**: 참가비 차감 후 참가자 등록
> * **참가 취소**: 참가비 환불 후 참가 취소
> * **팀 선택**: 참가자가 직접 팀 선택 가능
> * **팀 배정** (관리자): 랜덤 또는 수동 팀 배정
> * **취소** (관리자): 내전 취소 및 참가비 전액 환불

> ### <a:DH_MINA_03:1462813029577130200> 팀 배정 단계 (team_assign)
> * **팀 선택**: 참가자가 팀 이동 가능
> * **팀 배정** (관리자): 미배정 인원 랜덤 배정
> * **퇴장** (관리자): 특정 참가자 강제 퇴장 (환불)
> * **경기 시작** (관리자): 모든 팀 배정 확인 후 경기 시작
> * **취소** (관리자): 내전 취소

> ### <a:DH_MINA_03:1462813029577130200> 경기 중 (in_progress)
> * **결과 입력** (관리자): 순위별 팀 선택
> * **취소** (관리자): 내전 취소

> ### <a:DH_MINA_03:1462813029577130200> 경기 종료 (finished)
> * 순위별 보상 자동 분배
> * 팀원 간 균등 분배
> * 내전 메시지 10분 후 자동 삭제

---

> ## 8단계: 결과 입력 및 보상 분배
> ### <a:DH_MINA_03:1462813029577130200> 결과 입력 프로세스
> ```처리 흐름:
> 1. 결과 입력 버튼 클릭
> 2. 1등팀 선택 → 2등팀 선택 → ... (팀 수만큼)
> 3. 모든 순위 입력 완료
> 4. 보상 자동 분배 및 결과 표시```

> ### <a:DH_MINA_03:1462813029577130200> 보상 분배 로직
> * 상금풀 = 참가비 × 참가자 수
> * 각 팀 보상 = 상금풀 × 해당 순위 비율%
> * 개인 보상 = 팀 보상 ÷ 팀원 수
> <a:DH_MINA_03:1462813029577130200> 소수점 버림 처리, 남은 금액은 1등팀에 추가

---

> ## 9단계: 방장 권한
> ### <a:DH_MINA_03:1462813029577130200> 방장 기능
> * 내전 생성자(createdBy)는 해당 내전의 방장
> * 방장은 관리자와 동일한 권한 보유
> * 팀 배정, 퇴장, 경기 시작, 결과 입력, 취소 가능
> <a:DH_MINA_03:1462813029577130200> 관리자 승인 내전은 요청자가 방장이 됨

---

> ## <a:DH_MINA_05:1462814742178693160> 주의사항 및 제약
> ### 1. 승인 채널 미설정
> <a:DH_MINA_03:1462813029577130200> 일반 유저는 내전 생성 불가 (관리자만 가능)
> ### 2. 카테고리 미등록
> <a:DH_MINA_03:1462813029577130200> 카테고리 선택 버튼 비활성화, 직접 생성만 가능
> ### 3. 순위 비율 합계
> <a:DH_MINA_03:1462813029577130200> 합계가 100%가 아니면 설정 저장 불가
> ### 4. 잔액 부족
> <a:DH_MINA_03:1462813029577130200> 참가비가 부족한 유저는 참가 불가
> ### 5. 정원 초과
> <a:DH_MINA_03:1462813029577130200> 팀당 인원 제한 시 정원 초과 참가 불가

---

> ### <a:DH_MINA_13:1462814948127146005> 요약
> - 1. **패널 설치**: 디스코드 채널에 내전 패널 버튼 설치
> - 2. **관리 역할**: 내전 관리 권한 역할 지정
> - 3. **승인 채널**: 일반 유저 내전 요청 승인 워크플로우
> - 4. **참가비/보상**: 기본 참가비 및 순위별 보상 비율 설정
> - 5. **카테고리**: 게임별 프리셋 (팀 수, 인원, 보상)
> - 6. **진행 흐름**: 모집 → 팀 배정 → 경기 → 결과 입력 → 보상 분배
> - 7. **자동 분배**: 순위별 보상 계산 후 팀원 균등 분배
> - 8. **방장 권한**: 내전 생성자에게 관리 권한 부여
